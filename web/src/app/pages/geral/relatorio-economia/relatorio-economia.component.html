<div class="row"  *ngIf="!selected">
  <div class="col-md-12">
      <nb-card [nbSpinner]="loading" nbSpinnerStatus="info">
          <nb-card-header>Relatório de Economia</nb-card-header>
          <nb-card-body>
              <div class="row">
                  <div class="col-sm-2">
                      <div class="form-group">
                          <label for="inputEmail" class="label">Mês Referência</label><br />
                          <nb-select fullWidth placeholder="Selecione" (selectedChange)="onSearch($event)">
                              <nb-option>Selecione</nb-option>
                              <nb-option *ngFor="let mes of getMeses()"
                                  value="{{mes.id}}">{{mes.descricao}}</nb-option>
                          </nb-select>
                      </div>
                    </div>                   
              </div>
          </nb-card-body>
      </nb-card>
      <nb-card [nbSpinner]="loading" nbSpinnerStatus="info">
          <nb-card-header>Relatórios Emitidos</nb-card-header>
          <nb-card-body>
              <div class="row">
                  <div class="col-sm-12">
                      <ng2-smart-table [settings]="settings" [source]="source" (deleteConfirm)="onSelect($event)">
                      </ng2-smart-table>
                  </div>
              </div>
          </nb-card-body>
      </nb-card>        
  </div>
</div>

<form [formGroup]="control" *ngIf="selected">
    <div class="row">
        <div class="col-md-12">
            <nb-card accent="warning" [nbSpinner]="loading">
                <nb-card-header>Relatório de Economia {{relatorioEconomia.mesReferencia | date: 'MM/yyyy'}}</nb-card-header>
                <nb-card-body>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="subtitle sub-med">Unidade</div>
                            <div class="h7">{{relatorioEconomia.cabecalho.unidade}}</div>
                        </div>
                        <div class="col-md-2">
                            <div class="subtitle sub-med">Submercado</div>
                            <div class="h7">{{relatorioEconomia.cabecalho.subMercado}}</div>
                        </div>
                        <div class="col-md-2">
                            <div class="subtitle sub-med">Conexão</div>
                            <div class="h7">{{relatorioEconomia.cabecalho.conexao}}</div>
                        </div>
                        <div class="col-md-4">
                            <div class="subtitle sub-med">Concessão</div>
                            <div class="h7">{{relatorioEconomia.cabecalho.concessao}}</div>
                        </div>
                    </div>
                    <div class="row top-up">
                        <div class="col-md-2">
                            <div class="subtitle sub-med">CNPJ</div>
                            <div class="h7">{{relatorioEconomia.cabecalho.cnpj}}</div>
                        </div>
                        <div class="col-md-2">
                            <div class="subtitle sub-med">Inscrição Estadual</div>
                            <div class="h7">{{relatorioEconomia.cabecalho.inscricaoEstadual}}</div>
                        </div>
                        <div class="col-md-4">
                            <div class="subtitle sub-med">Endereço</div>
                            <div class="h7">{{relatorioEconomia.cabecalho.endereco}}</div>
                        </div>
                        <div class="col-md-2">
                            <div class="subtitle sub-med">Munucípio</div>
                            <div class="h7">{{relatorioEconomia.cabecalho.municipio}}</div>
                        </div>
                        <div class="col-md-2">
                            <div class="subtitle sub-med">UF</div>
                            <div class="h7">{{relatorioEconomia.cabecalho.uf}}</div>
                        </div>
                    </div>
                </nb-card-body>
            </nb-card>
        </div>
    </div>

    <div class="card-row" [nbSpinner]="loading">
        <div class="card-col">
            <nb-card accent="primary">
                <nb-card-body>
                    <nb-tabset>
                        <nb-tab tabTitle="Economia Mercado Livre vs. Mercado Cativo">
                            <nb-card style="border: 0rem;">
                                <nb-card-body>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="subtitle sub-med">Total Medido CCEE</div>
                                            <div class="h7">1111 kWh
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="subtitle sub-med">Perdas 3% (+)</div>
                                            <div class="h7">2222 MWh</div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="subtitle sub-med">PROINFA</div>
                                            <div class="h7">3333 MWh
                                            </div>
                                        </div> 
                                        <div class="col-md-3">
                                            <div class="subtitle sub-med">ICMS</div>
                                            <div class="h7">4444 %
                                            </div>
                                        </div>                                                                                                                                                                
                                    </div>
                                    <div class="row top-up">  
                                        <div class="col-md-3">
                                            <div class="subtitle sub-med">Dentro do Take</div>
                                            <div class="h7" style="color: #e5003d;">NÃO</div>
                                        </div>                                                                              
                                        <div class="col-md-3">
                                            <div class="subtitle sub-med">À faturar a longo prazo</div>
                                            <div class="h7">5555 MWh
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="subtitle sub-med">À comprar a curto prazo</div>
                                            <div class="h7">6666 MWh
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="subtitle sub-med">À vender a curto prazo</div>
                                            <div class="h7">7777 MWh</div>
                                        </div>
                                    </div>
                                </nb-card-body>
                            </nb-card>
                        </nb-tab>
                        <nb-tab tabTitle="Mercado Cativo - A4 - Total">
                            <nb-card style="border: 0rem;">
                                <nb-card-body>         
                                    <table class="fatura-tabela">
                                        <tr>
                                          <th></th>
                                          <th>Montante</th>
                                          <th>Tarifa</th>
                                          <th>Total</th>
                                        </tr>
                                      
                                        <tr>
                                          <td>Demanda Contratada - Ponta</td>
                                          <td>500,00</td>
                                          <td>40,00</td>
                                          <td>R$ 20.000,00</td>
                                        </tr>
                                        <tr>
                                          <td>Demanda Contratada - Fora de Ponta</td>
                                          <td>0,00</td>
                                          <td>32,71</td>
                                          <td>R$ 0,00</td>
                                        </tr>
                                        <tr>
                                          <td>Demanda Faturada - Ponta</td>
                                          <td>484,00</td>
                                          <td>27,15</td>
                                          <td>R$ 15.831,32</td>
                                        </tr>
                                        <tr>
                                          <td>Demanda Faturada - Fora de Ponta</td>
                                          <td>16,00</td>
                                          <td>65,42</td>
                                          <td>R$ 434,38</td>
                                        </tr>
                                        
                                        <tr>
                                          <td>Consumo Medido - Ponta - TUSD</td>
                                          <td>9.476,00</td>
                                          <td>2,04</td>
                                          <td>R$ 19.359,79</td>
                                        </tr>
                                        <tr>
                                          <td>Consumo Medido - Fora de Ponta - TUSD</td>
                                          <td>75.316,00</td>
                                          <td>0,12</td>
                                          <td>R$ 9.037,76</td>
                                        </tr>
                                        <tr>
                                          <td>Consumo Medido - Ponta - TE</td>
                                          <td>9.476,00</td>
                                          <td>0,50</td>
                                          <td>R$ 4.704,30</td>
                                        </tr>
                                        <tr>
                                          <td>Consumo Medido - Fora de Ponta - TE</td>
                                          <td>75.316,00</td>
                                          <td>0,31</td>
                                          <td>R$ 23.709,99</td>
                                        </tr>
                                        
                                        <tr class="total-linha">
                                          <td colspan="3"><strong>Total geral mercado cativo (impostos inclusos)</strong></td>
                                          <td><strong>R$ 73.099,18</strong></td>
                                        </tr>
                                      </table>
                                                               
                                </nb-card-body>
                            </nb-card>
                        </nb-tab>
                        <nb-tab tabTitle="Mercado Livre - A4">
                            <nb-card style="border: 0rem;">
                                <nb-card-body>
                                    <table class="fatura-tabela">
                                        <tr>
                                          <th></th>
                                          <th>Montante</th>
                                          <th>Tarifa</th>
                                          <th>Total (R$)</th>
                                        </tr>
                                      
                                        <tr>
                                          <td>TUSD Encargos - Ponta</td>
                                          <td>9.476,00</td>
                                          <td>1,09</td>
                                          <td>R$ 10.285,67</td>
                                        </tr>
                                        <tr>
                                          <td>TUSD Encargos - Fora de Ponta</td>
                                          <td>75.316,00</td>
                                          <td>0,12</td>
                                          <td>R$ 9.037,76</td>
                                        </tr>
                                        <tr>
                                          <td>Consumo Reativo - Ponta</td>
                                          <td>0,00</td>
                                          <td>0,37</td>
                                          <td>R$ 0,00</td>
                                        </tr>
                                        <tr>
                                          <td>Consumo Reativo - Fora de Ponta</td>
                                          <td>60,23</td>
                                          <td>0,37</td>
                                          <td>R$ 22,28</td>
                                        </tr>
                                      
                                        <tr>
                                          <td>Subvenção Tarifária - TUSD - Com ICMS DEZ/23</td>
                                          <td colspan="2"></td>
                                          <td>R$ 16.957,42</td>
                                        </tr>
                                        <tr>
                                          <td>Subvenção Tarifária - TUSD - Sem ICMS DEZ/23</td>
                                          <td colspan="2"></td>
                                          <td>R$ 216,31</td>
                                        </tr>
                                      
                                        <tr class="total-linha">
                                          <td colspan="3"><strong>Sub-total para base de cálculo imposto ICMS/PIS/COFINS</strong></td>
                                          <td><strong>R$ 44.685,51</strong></td>
                                        </tr>
                                      
                                        <tr>
                                          <td>Ajustes da TUSD</td>
                                          <td colspan="2"></td>
                                          <td>R$ 36,85</td>
                                        </tr>
                                        <tr>
                                          <td>Crédito Subv. Tarifa ACL TUSD</td>
                                          <td colspan="2"></td>
                                          <td>-R$ 13.517,83</td>
                                        </tr>
                                      
                                        <tr class="total-linha">
                                          <td colspan="3"><strong>Total distribuidora</strong></td>
                                          <td><strong>R$ 31.204,53</strong></td>
                                        </tr>
                                      
                                        <tr>
                                          <td>Ressarcimento</td>
                                          <td colspan="2"></td>
                                          <td>R$ 0,00</td>
                                        </tr>
                                        <tr>
                                          <td>Multa</td>
                                          <td colspan="2"></td>
                                          <td>R$ 0,00</td>
                                        </tr>
                                        <tr>
                                          <td>Juros</td>
                                          <td colspan="2"></td>
                                          <td>R$ 0,00</td>
                                        </tr>
                                      
                                        <tr class="total-linha">
                                          <td colspan="3"><strong>Sub-total de valores referente à Distribuidora</strong></td>
                                          <td><strong>R$ 31.273,79</strong></td>
                                        </tr>
                                      
                                        <tr>
                                          <td>Serviço Depositário Qualificado - Bradesco Ref.: 12/23</td>
                                          <td colspan="2"></td>
                                          <td>R$ 42,24</td>
                                        </tr>

                                        <tr class="total-linha">
                                            <td colspan="3"><strong>Sub-total dos outros custos mercado livre</strong></td>
                                            <td><strong>R$ 2.020,95</strong></td>
                                        </tr>

                                        <tr class="total-linha">
                                            <td colspan="2"><strong>Total geral mercado livre (impostos inclusos)</strong></td>
                                            <td><strong>0,72</strong></td>
                                            <td><strong>R$ 61.403,12</strong></td>
                                        </tr>
  
                                      </table>                                                   
                                </nb-card-body>
                            </nb-card>
                        </nb-tab>
                    </nb-tabset>
                </nb-card-body>
                <nb-card-footer>
                    <button type="submit" nbButton status="basic" (click)="clear()">Voltar</button>
                    <button *ngIf="habilitaOperacoes" [disabled]="!control.valid || !habilitaPdf()" type="submit" nbButton status="info" style="margin-left: 0.5rem;" (click)="salvar()">Salvar</button>
                    <button *ngIf="habilitaOperacoes" [disabled]="!habilitaPdf()" type="submit" nbButton (click)="validar()" status="danger" style="margin-left: 0.5rem;">Validar</button>

                    <button [disabled]="!habilitaPdf()" type="submit" nbButton status="warning" style="margin-left: 0.5rem;" (click)="downloadAsPdf()">Gerar PDF</button>
                </nb-card-footer>                
            </nb-card>
        </div>
    </div>
</form>